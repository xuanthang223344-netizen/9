<!DOCTYPE html>  
<html lang="vi">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Shop Th·ªè Fruits</title>  
    <style>  
        /* LOGIN SCREEN - M√ÄN H√åNH ƒêƒÇNG NH·∫¨P */ 
        .login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            z-index: 2000; display: flex; align-items: center; justify-content: center; 
        } 
        .login-container { 
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.3); max-width: 400px; width: 90%; 
            text-align: center; 
        } 
        .login-container h2 {  
            color: #333; margin-bottom: 20px; font-size: 2em;  
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        } 
        .login-input-group { margin-bottom: 20px; } 
        .login-input-group label {  
            display: block; margin-bottom: 8px; font-weight: 600; color: #333;  
        } 
        .login-input-group input { 
            width: 100%; padding: 15px; border: 2px solid #e1e5e9; 
            border-radius: 10px; font-size: 16px; box-sizing: border-box; 
            transition: all 0.3s ease; 
        } 
        .login-input-group input:focus { 
            outline: none; border-color: #4facfe; 
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1); 
        } 
        .login-btn { 
            width: 100%; padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            color: white; border: none; border-radius: 10px; font-size: 16px; 
            font-weight: 600; cursor: pointer; transition: all 0.3s ease; 
        } 
        .login-btn:hover {  
            transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2);  
        } 
        .login-error {  
            color: #e74c3c; margin-top: 10px; display: none;  
            background: #fee; padding: 10px; border-radius: 5px; font-weight: 500; 
        } 
        .logout-btn { 
            position: fixed; top: 20px; right: 20px; z-index: 1000; 
            background: #e74c3c; color: white; border: none; padding: 10px 20px; 
            border-radius: 25px; cursor: pointer; font-weight: 600; 
        } 
        .logout-btn:hover { background: #c0392b; } 
 
        /* ·∫®N TO√ÄN B·ªò APP KHI CH∆ØA LOGIN */ 
        .app-hidden { display: none !important; } 
 
        /* Base Reset & Body Styles */  
        * { margin: 0; padding: 0; box-sizing: border-box; }  
        body {  
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;  
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);  
            min-height: 100vh; padding: 20px;  
        }  
  
        /* Main Container */  
        .container {  
            max-width: 1200px; margin: 0 auto;  
            background: white; border-radius: 20px;  
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden;  
        }  
  
        /* Header */  
        .header {  
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);  
            color: white; padding: 30px; text-align: center;  
        }  
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }  
        .header p { font-size: 1.2em; }  
  
        /* Main Content Area */  
        .main-content { padding: 40px; }  
  
        /* Input Section (Add New Order) */  
        .input-section {  
            display: grid; grid-template-columns: 1fr 1fr;  
            gap: 20px; margin-bottom: 30px;  
        }  
        .input-group { display: flex; flex-direction: column; }  
        .input-group label { margin-bottom: 8px; font-weight: 600; color: #333; }  
        .input-group input {  
            padding: 15px; border: 2px solid #e1e5e9;  
            border-radius: 10px; font-size: 16px;  
            transition: all 0.3s ease;  
        }  
        .input-group input:focus {  
            outline: none; border-color: #4facfe;  
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);  
        }  
  
        /* Buttons */  
        .btn {  
            padding: 15px 30px; border: none;  
            border-radius: 10px; font-size: 16px;  
            font-weight: 600; cursor: pointer;  
            transition: all 0.3s ease; display: flex;  
            align-items: center; justify-content: center; gap: 10px;  
            width: fit-content; margin-top: 20px;  
        }  
        .btn-save-order {  
            background: linear-gradient(135deg, #56ab2f, #a8e6cf); color: white;  
        }  
        .btn-delete {  
            background: linear-gradient(135deg, #e74c3c, #c0392b); color: white;  
            padding: 12px 20px; font-size: 14px;  
        }  
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }  
  
        /* Search & Reset Section */  
        .management-section {  
            background: #f8f9fa; padding: 25px;  
            border-radius: 15px; margin-bottom: 30px;  
            display: grid; grid-template-columns: 2fr 1fr 1fr;  
            gap: 20px;  
        }  
        .management-section h3 { margin-bottom: 15px; color: #333; }  
        #searchEmployee {  
            width: 100%; padding: 15px; border: 2px solid #e1e5e9;  
            border-radius: 10px; font-size: 16px;  
        }  
        #searchEmployee:focus {  
            outline: none; border-color: #4facfe;  
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);  
        }  
        .employee-stats-card {  
            margin-top: 15px; padding: 15px; background: white;  
            border-radius: 10px; display: none;  
        }  
        .management-section .btn { width: 100%; margin-top: 0; }  
  
        /* Transaction History */  
        .transactions {  
            background: white; border-radius: 15px;  
            padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);  
        }  
        .transactions h3 { margin-bottom: 20px; color: #333; font-size: 1.5em; }  
        .transaction-list { max-height: 500px; overflow-y: auto; }  
        .transaction-item {  
            display: flex; justify-content: space-between;  
            align-items: center; padding: 20px; margin-bottom: 15px;  
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);  
            border-radius: 12px; border-left: 5px solid #4facfe;  
            cursor: pointer; transition: all 0.2s ease;  
        }  
        .transaction-item:hover {  
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);  
            transform: translateY(-2px); border-left: 5px solid #00f2fe;  
        }  
        .transaction-info h4 { color: #333; margin-bottom: 5px; }  
        .transaction-amount.add { color: #27ae60; font-weight: bold; font-size: 1.3em; }  
        .transaction-amount.subtract { color: #e74c3c; font-weight: bold; font-size: 1.3em; }  
        .date { color: #7f8c8d; font-size: 0.9em; }  
        .no-data {  
            text-align: center; color: #7f8c8d;  
            font-style: italic; padding: 40px;  
        }  
  
        /* Dialogs */  
        .overlay {  
            position: fixed; top: 0; left: 0;  
            width: 100%; height: 100%;  
            background: rgba(0,0,0,0.5); z-index: 999; display: none;  
        }  
        .confirm-dialog, .edit-transaction-dialog {  
            position: fixed; top: 50%; left: 50%;  
            transform: translate(-50%, -50%); background: white;  
            padding: 30px; border-radius: 15px;  
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);  
            z-index: 1000; display: none; max-width: 450px; text-align: center;  
        }  
        .edit-transaction-dialog .input-group { margin-bottom: 15px; }  
        .edit-transaction-dialog .btn-group {  
            display: flex; justify-content: center; gap: 10px; margin-top: 20px;  
        }  
        .edit-transaction-dialog input[type="text"],  
        .edit-transaction-dialog input[type="number"] { width: 100%; }  
  
        /* Responsive */  
        @media (max-width: 768px) {  
            .input-section, .management-section { grid-template-columns: 1fr; }  
            .btn { width: 100%; }  
        }  
    </style>  
</head>  
<body>  
    <!-- üîê M√ÄN H√åNH ƒêƒÇNG NH·∫¨P - HI·ªÜN L√äN TR∆Ø·ªöC --> 
    <div class="login-overlay" id="loginScreen"> 
        <div class="login-container"> 
            <h2>üîê ƒêƒÉng nh·∫≠p Qu·∫£n l√Ω ƒê∆°n h√†ng</h2> 
            <div class="login-input-group"> 
                <label>üì± M·∫≠t kh·∫©u qu·∫£n tr·ªã:</label> 
                <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ truy c·∫≠p"> 
            </div> 
            <button class="login-btn" onclick="checkPassword()">üöÄ Truy c·∫≠p h·ªá th·ªëng</button> 
            <div class="login-error" id="loginError">‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!</div> 
        </div> 
    </div> 
 
    <!-- N√öT ƒêƒÇNG XU·∫§T (ch·ªâ hi·ªán khi ƒë√£ login) --> 
    <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">üö™ Tho√°t</button> 
 
    <div class="overlay" id="overlay"></div>  
      
    <!-- Dialog x√°c nh·∫≠n chung -->  
    <div class="confirm-dialog" id="confirmDialog">  
        <h3 id="confirmTitle">X√°c nh·∫≠n</h3>  
        <p id="confirmMessage"></p>  
        <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: center;">  
            <button class="btn btn-delete" id="confirmActionBtn" style="width: 120px;">X√°c nh·∫≠n</button>  
            <button class="btn" onclick="closeDialog('confirmDialog')" style="background: #6c757d; width: 120px;">H·ªßy</button>  
        </div>  
    </div>  
  
    <!-- Dialog ch·ªânh s·ª≠a/th√™m/tr·ª´ ti·ªÅn cho m·ªôt ƒë∆°n h√†ng -->  
    <div class="edit-transaction-dialog" id="editTransactionDialog">  
        <h3>Ch·ªânh s·ª≠a ƒë∆°n h√†ng</h3>  
        <div class="input-group">  
            <label>T√™n nh√¢n vi√™n:</label>  
            <input type="text" id="editEmployeeName" readonly>  
        </div>  
        <div class="input-group">  
            <label>M√¥ t·∫£ ƒë∆°n h√†ng g·ªëc:</label>  
            <input type="text" id="editTransactionDescription" readonly>  
        </div>  
        <div class="input-group">  
            <label>S·ªë ti·ªÅn hi·ªán t·∫°i:</label>  
            <input type="text" id="editCurrentAmount" readonly>  
        </div>  
        <div class="input-group">  
            <label>Nh·∫≠p s·ªë ti·ªÅn ƒëi·ªÅu ch·ªânh (v√≠ d·ª•: 10,-20 ho·∫∑c 5,10):</label>  
            <input type="text" id="adjustmentAmount" placeholder="10,20 ho·∫∑c -50">  
        </div>  
        <div class="btn-group">  
            <button class="btn" style="background: #56ab2f;" onclick="adjustTransactionAmount('add')" >‚ûï Th√™m v√†o ƒë∆°n</button>  
            <button class="btn" style="background: #ff6b6b;" onclick="adjustTransactionAmount('subtract')" >‚ûñ Tr·ª´ kh·ªèi ƒë∆°n</button>  
        </div>  
        <div class="btn-group" style="margin-top: 10px;">  
            <button class="btn btn-delete" onclick="deleteSingleTransaction()" >üóëÔ∏è X√≥a ƒë∆°n n√†y</button>  
            <button class="btn" onclick="closeDialog('editTransactionDialog')" style="background: #6c757d;" >ƒê√≥ng</button>  
        </div>  
    </div>  
  
    <!-- APP CH√çNH - ·∫®N KHI CH∆ØA LOGIN --> 
    <div class="container app-hidden" id="mainApp"> 
        <div class="header">  
            <h1>üìä Qu·∫£n L√Ω ƒê∆°n H√†ng Nh√¢n Vi√™n</h1>  
            <p>T·ªïng h√¥m nay: <span id="todayTotal">0 VNƒê</span></p>  
        </div>  
  
        <div class="main-content">  
            <!-- Ph·∫ßn nh·∫≠p ƒë∆°n h√†ng m·ªõi -->  
            <div class="input-section">  
                <div class="input-group">  
                    <label>üîπ T√™n nh√¢n vi√™n:</label>  
                    <input type="text" id="employeeName" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n">  
                </div>  
                <div class="input-group">  
                    <label>üí∞ ƒê∆°n h√†ng (v√≠ d·ª•: 10,20,30 = 60.000 VNƒê):</label>  
                    <input type="text" id="amount" placeholder="Nh·∫≠p 10,20,30">  
                    <button class="btn btn-save-order" onclick="saveOrder()">  
                        üíæ L∆∞u ƒë∆°n h√†ng  
                    </button>  
                </div>  
            </div>  
  
            <!-- Ph·∫ßn qu·∫£n l√Ω: T√¨m ki·∫øm, X√≥a NV, Reset D·ªØ li·ªáu -->  
            <div class="management-section">  
                <div>  
                    <h3>üîç T√¨m l·ªãch s·ª≠ nh√¢n vi√™n</h3>  
                    <input type="text" id="searchEmployee" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n ƒë·ªÉ xem l·ªãch s·ª≠..."   
                           oninput="filterEmployeeHistory()">  
                    <div id="employeeStats" class="employee-stats-card"></div>  
                </div>  
                <div>  
                    <h3 style="color: #e74c3c;">üóëÔ∏è X√≥a nh√¢n vi√™n</h3>  
                    <input type="text" id="employeeToDelete" placeholder="Nh·∫≠p t√™n NV ƒë·ªÉ x√≥a to√†n b·ªô ƒë∆°n...">  
                    <button class="btn btn-delete" onclick="deleteEmployee()">  
                        X√≥a to√†n b·ªô NV n√†y  
                    </button>  
                </div>  
                <div>  
                    <h3 style="color: #6c757d;">üîÑ ƒê·∫∑t l·∫°i d·ªØ li·ªáu</h3>  
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">X√≥a to√†n b·ªô d·ªØ li·ªáu (c·∫©n th·∫≠n!)</p>  
                    <button class="btn" style="background: #6c757d;" onclick="resetAllData()">  
                        X√≥a to√†n b·ªô d·ªØ li·ªáu  
                    </button>  
                </div>  
            </div>  
  
            <!-- L·ªãch s·ª≠ giao d·ªãch/ƒë∆°n h√†ng -->  
            <div class="transactions">  
                <h3>üìã L·ªãch s·ª≠ ƒë∆°n h√†ng hi·ªán t·∫°i</h3>  
                <div class="transaction-list" id="transactionList">  
                    <div class="no-data">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o h√¥m nay</div>  
                </div>  
            </div>  
        </div>  
    </div>  
  
    <script>  
        let transactions = JSON.parse(localStorage.getItem('employeeTransactions')) || [];  
        let editingTransactionId = null;  
 
        // üî• üî• üî• PH·∫¶N M·∫¨T KH·∫®U - ƒê·ªîI M·∫¨T KH·∫®U T·∫†I ƒê√ÇY üî• üî• üî• 
        const ADMIN_PASSWORD = "0965579926"; // üëà ƒê·ªîI M·∫¨T KH·∫®U C·ª¶A B·∫†N V√ÄO ƒê√ÇY 
         
        // Ki·ªÉm tra ƒëƒÉng nh·∫≠p 
        function checkPassword() { 
            const password = document.getElementById('loginPassword').value; 
            const errorDiv = document.getElementById('loginError'); 
             
            if (password === ADMIN_PASSWORD) { 
                // ƒê√öNG M·∫¨T KH·∫®U ‚Üí HI·ªÜN APP, ·∫®N LOGIN 
                document.getElementById('loginScreen').style.display = 'none'; 
                document.getElementById('mainApp').classList.remove('app-hidden'); 
                document.getElementById('logoutBtn').style.display = 'block'; 
                document.getElementById('loginPassword').value = ''; // X√≥a input 
                alert('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch√†o m·ª´ng ƒë·∫øn h·ªá th·ªëng qu·∫£n l√Ω.'); 
                initApp(); // Kh·ªüi t·∫°o app 
            } else { 
                // SAI M·∫¨T KH·∫®U ‚Üí HI·ªÜN L·ªñI 
                errorDiv.style.display = 'block'; 
                document.getElementById('loginPassword').value = ''; 
                document.getElementById('loginPassword').focus(); 
                setTimeout(() => errorDiv.style.display = 'none', 3000); 
            } 
        } 
 
        // ƒêƒÉng xu·∫•t 
        function logout() { 
            if (confirm('üö™ B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) { 
                document.getElementById('loginScreen').style.display = 'flex'; 
                document.getElementById('mainApp').classList.add('app-hidden'); 
                document.getElementById('logoutBtn').style.display = 'none'; 
                transactions = []; // X√≥a d·ªØ li·ªáu t·∫°m th·ªùi 
                localStorage.clear(); // X√ìA TO√ÄN B·ªò localStorage 
            } 
        } 
 
        // Enter ƒë·ªÉ ƒëƒÉng nh·∫≠p nhanh 
        document.getElementById('loginPassword').addEventListener('keypress', function(e) { 
            if (e.key === 'Enter') checkPassword(); 
        }); 
 
        // --- H√†m h·ªó tr·ª£ ---  
        function parseAndSumAmounts(inputString) {  
            if (!inputString || inputString.trim() === '') return 0;  
              
            const cleanString = inputString.replace(/[^\d,\+\-]/g, '');   
            const parts = cleanString.split(/[,\+]/).flatMap(part => {  
                if (part.includes('-')) {  
                    return part.split('-').filter(s => s !== '').map((s, idx) => {  
                        return idx === 0 ? s : `-${s}`;  
                    });  
                }  
                return part;  
            });  
  
            let sum = 0;  
            for (const part of parts) {  
                const num = parseFloat(part.trim());  
                if (!isNaN(num)) {  
                    sum += num;  
                }  
            }  
            return sum;  
        }  
  
        function formatCurrency(amount) {  
            return new Intl.NumberFormat('vi-VN', {  
                style: 'currency',  
                currency: 'VND'  
            }).format(amount);  
        }  
  
        function getTodayDate() {  
            return new Date().toISOString().split('T')[0];  
        }  
  
        function calculateTodayTotal() {  
            const today = getTodayDate();  
            return transactions  
                .filter(t => t.date === today)  
                .reduce((sum, t) => sum + t.amount, 0);  
        }  
  
        function updateStats() {  
            document.getElementById('todayTotal').textContent = formatCurrency(calculateTodayTotal());  
        }  
  
        // --- Hi·ªÉn th·ªã giao d·ªãch ---  
        function displayTransactions(filteredTrans = null) {  
            const list = document.getElementById('transactionList');  
            let transactionsToDisplay = filteredTrans;  
  
            if (!filteredTrans) {  
                transactionsToDisplay = transactions.filter(t => t.date === getTodayDate());  
            }  
              
            transactionsToDisplay = [...transactionsToDisplay].sort((a, b) => b.id - a.id);  
  
            if (transactionsToDisplay.length === 0) {  
                list.innerHTML = '<div class="no-data">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o h√¥m nay ho·∫∑c kh√¥ng t√¨m th·∫•y.</div>';  
                return;  
            }  
  
            list.innerHTML = transactionsToDisplay  
                .map(t => `  
                    <div class="transaction-item" onclick="openEditTransactionDialog(${t.id})">  
                        <div class="transaction-info">  
                            <h4>${t.employee}</h4>  
                            <div class="date">${new Date(t.date + 'T' + t.time).toLocaleString('vi-VN')}</div>  
                            <p style="font-size: 0.9em; color: #666;">${t.description}</p>  
                        </div>  
                        <div class="transaction-amount ${t.amount >= 0 ? 'add' : 'subtract'}">  
                            ${formatCurrency(t.amount)}  
                        </div>  
                    </div>  
                `).join('');  
        }  
  
        // Kh·ªüi t·∫°o app sau khi login 
        function initApp() { 
            // Load l·∫°i d·ªØ li·ªáu t·ª´ localStorage 
            const savedData = localStorage.getItem('employeeTransactions'); 
            if (savedData) { 
                transactions = JSON.parse(savedData); 
            } 
            updateStats(); 
            displayTransactions(); 
        } 
  
        // L∆∞u ƒë∆°n h√†ng m·ªõi  
        function saveOrder() {  
            const name = document.getElementById('employeeName').value.trim();  
            const amountInput = document.getElementById('amount').value.trim();  
            const totalAmount = parseAndSumAmounts(amountInput);  
  
            if (!name) {  
                alert('‚ùå Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n!');  
                return;  
            }  
            if (totalAmount === 0 && amountInput !== '0') {  
                alert(`‚ùå S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá! Vui l√≤ng ki·ªÉm tra l·∫°i ƒë·ªãnh d·∫°ng nh·∫≠p.`);  
                return;  
            }  
            if (amountInput === '') {  
                alert('‚ùå Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn cho ƒë∆°n h√†ng!');  
                return;  
            }  
  
            const transaction = {  
                id: Date.now(),  
                employee: name,  
                amount: totalAmount,  
                type: totalAmount >= 0 ? 'add' : 'subtract',  
                date: getTodayDate(),  
                time: new Date().toLocaleTimeString('vi-VN'),  
                description: amountInput  
            };  
  
            transactions.unshift(transaction);  
            localStorage.setItem('employeeTransactions', JSON.stringify(transactions));  
              
            updateStats();  
            displayTransactions();  
            clearInputs();  
            alert(`‚úÖ ƒê√£ l∆∞u ƒë∆°n h√†ng:\nNh√¢n vi√™n: ${name}\nT·ªïng ti·ªÅn: ${formatCurrency(totalAmount)}\n(${amountInput})`);  
        }  
  
        // C√°c h√†m c√≤n l·∫°i gi·ªØ nguy√™n... 
        function openEditTransactionDialog(id) {  
            editingTransactionId = id;  
            const transaction = transactions.find(t => t.id === id);  
  
            if (!transaction) {  
                alert('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†y.');  
                return;  
            }  
  
            document.getElementById('editEmployeeName').value = transaction.employee;  
            document.getElementById('editTransactionDescription').value = transaction.description;  
            document.getElementById('editCurrentAmount').value = formatCurrency(transaction.amount);  
            document.getElementById('adjustmentAmount').value = '';  
  
            showDialog('editTransactionDialog');  
        }  
  
        function adjustTransactionAmount(actionType) {  
            if (!editingTransactionId) return;  
  
            const transactionIndex = transactions.findIndex(t => t.id === editingTransactionId);  
            if (transactionIndex === -1) return;  
  
            const adjustmentInput = document.getElementById('adjustmentAmount').value.trim();  
            const adjustmentValue = parseAndSumAmounts(adjustmentInput);  
  
            if (adjustmentInput === '' || adjustmentValue === 0) {  
                alert('‚ùå Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn ƒëi·ªÅu ch·ªânh h·ª£p l·ªá!');  
                return;  
            }  
  
            let currentAmount = transactions[transactionIndex].amount;  
            let newAmount;  
  
            if (actionType === 'add') {  
                newAmount = currentAmount + adjustmentValue;  
            } else if (actionType === 'subtract') {  
                newAmount = currentAmount - adjustmentValue;  
            }  
  
            transactions[transactionIndex].amount = newAmount;  
            transactions[transactionIndex].type = newAmount >= 0 ? 'add' : 'subtract';  
            transactions[transactionIndex].time = new Date().toLocaleTimeString('vi-VN');  
            transactions[transactionIndex].description += ` | ƒêi·ªÅu ch·ªânh (${actionType === 'add' ? '+' : '-'}${adjustmentInput})`;  
  
            localStorage.setItem('employeeTransactions', JSON.stringify(transactions));  
              
            updateStats();  
            if (document.getElementById('searchEmployee').value.trim()) {  
                filterEmployeeHistory();  
            } else {  
                displayTransactions();  
            }  
            closeDialog('editTransactionDialog');  
            editingTransactionId = null;  
        }  
  
        function deleteSingleTransaction() {  
            if (!editingTransactionId) return;  
  
            showConfirmDialog(  
                'X√≥a ƒë∆°n h√†ng n√†y?',  
                'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n h√†ng n√†y kh√¥ng?',  
                () => {  
                    transactions = transactions.filter(t => t.id !== editingTransactionId);  
                    localStorage.setItem('employeeTransactions', JSON.stringify(transactions));  
                    updateStats();  
                    displayTransactions();  
                    closeDialog('confirmDialog');  
                    closeDialog('editTransactionDialog');  
                    editingTransactionId = null;  
                }  
            );  
        }  
  
        function deleteEmployee() {  
            const employeeName = document.getElementById('employeeToDelete').value.trim();  
              
            if (!employeeName) {  
                alert('‚ùå Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n c·∫ßn x√≥a!');  
                return;  
            }  
  
            const employeeTransactionsCount = transactions.filter(t => t.employee.toLowerCase() === employeeName.toLowerCase()).length;  
              
            if (employeeTransactionsCount === 0) {  
                alert('‚ùå Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o cho nh√¢n vi√™n n√†y!');  
                return;  
            }  
  
            showConfirmDialog(  
                `X√≥a to√†n b·ªô ƒë∆°n c·ªßa "${employeeName}"?`,   
                `B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${employeeTransactionsCount} ƒë∆°n h√†ng?`,  
                () => {  
                    transactions = transactions.filter(t => t.employee.toLowerCase() !== employeeName.toLowerCase());  
                    localStorage.setItem('employeeTransactions', JSON.stringify(transactions));  
                    document.getElementById('employeeToDelete').value = '';  
                    updateStats();  
                    displayTransactions();  
                    document.getElementById('searchEmployee').value = '';  
                    document.getElementById('employeeStats').style.display = 'none';  
                    closeDialog('confirmDialog');  
                }  
            );  
        }  
  
        function resetAllData() {  
            showConfirmDialog(  
                'X√≥a to√†n b·ªô d·ªØ li·ªáu?',  
                'T·∫•t c·∫£ ƒë∆°n h√†ng s·∫Ω b·ªã x√≥a Vƒ®NH VI·ªÑN!',  
                () => {  
                    localStorage.removeItem('employeeTransactions');  
                    transactions = [];  
                    updateStats();  
                    displayTransactions();  
                    document.getElementById('searchEmployee').value = '';  
                    document.getElementById('employeeStats').style.display = 'none';  
                    closeDialog('confirmDialog');  
                    alert('‚úÖ ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu!');  
                }  
            );  
        }  
  
        function filterEmployeeHistory() {  
            const searchTerm = document.getElementById('searchEmployee').value.trim().toLowerCase();  
            const employeeStats = document.getElementById('employeeStats');  
              
            if (!searchTerm) {  
                employeeStats.style.display = 'none';  
                displayTransactions();  
                return;  
            }  
  
            const employeeTransactions = transactions.filter(t =>   
                t.employee.toLowerCase().includes(searchTerm)  
            );  
  
            if (employeeTransactions.length === 0) {  
                employeeStats.style.display = 'none';  
                document.getElementById('transactionList').innerHTML = '<div class="no-data">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o cho nh√¢n vi√™n n√†y.</div>';  
                return;  
            }  
  
            const totalAmount = employeeTransactions.reduce((sum, t) => sum + t.amount, 0);  
            const todayAmount = employeeTransactions  
                .filter(t => t.date === getTodayDate())  
                .reduce((sum, t) => sum + t.amount, 0);  
  
            employeeStats.innerHTML = `  
                <div style="display: flex; justify-content: space-between; align-items: center;">  
                    <div>  
                        <h4 style="margin: 0; color: #333;">üìä Th·ªëng k√™ ${searchTerm.toUpperCase()}</h4>  
                        <p style="margin: 5px 0; color: #666;">  
                            H√¥m nay: ${formatCurrency(todayAmount)} |   
                            T·ªïng: ${formatCurrency(totalAmount)} |   
                            <span style="color: #e74c3c;">${employeeTransactions.length} ƒë∆°n</span>  
                        </p>  
                    </div>  
                    <div style="font-size: 1.2em; font-weight: bold; color: ${totalAmount >= 0 ? '#27ae60' : '#e74c3c'};">  
                        ${formatCurrency(totalAmount)}  
                    </div>  
                </div>  
            `;  
            employeeStats.style.display = 'block';  
            displayTransactions(employeeTransactions);  
        }  
  
        function showConfirmDialog(title, message, onConfirmCallback) {  
            document.getElementById('confirmTitle').textContent = title;  
            document.getElementById('confirmMessage').textContent = message;  
            document.getElementById('confirmActionBtn').onclick = onConfirmCallback;  
            showDialog('confirmDialog');  
        }  
  
        function showDialog(dialogId) {  
            document.getElementById('overlay').style.display = 'block';  
            document.getElementById(dialogId).style.display = 'block';  
        }  
  
        function closeDialog(dialogId) {  
            document.getElementById('overlay').style.display = 'none';  
            document.getElementById(dialogId).style.display = 'none';  
        }  
  
        function clearInputs() {  
            document.getElementById('amount').value = '';  
            document.getElementById('employeeName').focus();  
        }  
  
        document.addEventListener('keypress', function(e) {  
            if (e.key === 'Enter' && e.target.id === 'amount') {  
                saveOrder();  
            } else if (e.key === 'Enter' && e.target.id === 'employeeName') {  
                e.preventDefault();  
                document.getElementById('amount').focus();  
            } else if (e.key === 'Enter' && e.target.id === 'adjustmentAmount') {  
                adjustTransactionAmount('add');  
            }  
        });  
    </script>  
</body>  
</html> 
