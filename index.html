<!DOCTYPE html> 
<html lang="vi"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Qu·∫£n L√Ω Nh√¢n Vi√™n</title> 
    <style> 
        /* LOGIN SCREEN - M√ÄN H√åNH ƒêƒÇNG NH·∫¨P */ 
        .login-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            z-index: 2000; display: flex; align-items: center; justify-content: center; 
        } 
        .login-container { 
            background: white; padding: 40px; border-radius: 20px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.3); max-width: 400px; width: 90%; 
            text-align: center; 
        } 
        .login-container h2 { 
            color: #333; margin-bottom: 20px; font-size: 2em; 
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        } 
        .login-input-group { margin-bottom: 20px; } 
        .login-input-group label { 
            display: block; margin-bottom: 8px; font-weight: 600; color: #333; 
        } 
        .login-input-group input { 
            width: 100%; padding: 15px; border: 2px solid #e1e5e9; 
            border-radius: 10px; font-size: 16px; box-sizing: border-box; 
            transition: all 0.3s ease; 
        } 
        .login-input-group input:focus { 
            outline: none; border-color: #4facfe; 
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1); 
        } 
        .login-btn { 
            width: 100%; padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            color: white; border: none; border-radius: 10px; font-size: 16px; 
            font-weight: 600; cursor: pointer; transition: all 0.3s ease; 
        } 
        .login-btn:hover { 
            transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
        } 
        .login-error { 
            color: #e74c3c; margin-top: 10px; display: none; 
            background: #fee; padding: 10px; border-radius: 5px; font-weight: 500; 
        } 
        .logout-btn { 
            position: fixed; top: 20px; right: 20px; z-index: 1000; 
            background: #e74c3c; color: white; border: none; padding: 10px 20px; 
            border-radius: 25px; cursor: pointer; font-weight: 600; 
        } 
        .logout-btn:hover { background: #c0392b; } 
 
        /* ·∫®N TO√ÄN B·ªò APP KHI CH∆ØA LOGIN */ 
        .app-hidden { display: none !important; } 
 
        /* Base Reset & Body Styles */ 
        * { margin: 0; padding: 0; box-sizing: border-box; } 
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; padding: 20px; 
        } 
 
        /* Main Container */ 
        .container { 
            max-width: 1200px; margin: 0 auto; 
            background: white; border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; 
        } 
 
        /* Header */ 
        .header { 
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
            color: white; padding: 30px; text-align: center; 
        } 
        .header h1 { font-size: 2.5em; margin-bottom: 10px; } 
        .header p { font-size: 1.2em; } 
 
        /* Main Content Area */ 
        .main-content { padding: 40px; } 
 
        /* Input Section (Add New Order) */ 
        .input-section { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; margin-bottom: 30px; 
        } 
        .input-group { display: flex; flex-direction: column; } 
        .input-group label { margin-bottom: 8px; font-weight: 600; color: #333; } 
        .input-group input[type="text"], .input-group input[type="number"], .input-group textarea { 
            padding: 15px; border: 2px solid #e1e5e9; 
            border-radius: 10px; font-size: 16px; 
            transition: all 0.3s ease; width: 100%; 
            box-sizing: border-box; 
        } 
        .input-group input[type="text"]:focus, .input-group input[type="number"]:focus, .input-group textarea:focus { 
            outline: none; border-color: #4facfe; 
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1); 
        } 
        .input-group .input-hint { 
            font-size: 0.85em; color: #666; margin-top: 5px; font-style: italic; 
        } 
 
        /* Buttons */ 
        .btn { 
            padding: 15px 30px; border: none; 
            border-radius: 10px; font-size: 16px; 
            font-weight: 600; cursor: pointer; 
            transition: all 0.3s ease; display: flex; 
            align-items: center; justify-content: center; gap: 10px; 
            width: fit-content; margin-top: 20px; 
        } 
        .btn-save-order { 
            background: linear-gradient(135deg, #56ab2f, #a8e6cf); color: white; 
        } 
        .btn-delete { 
            background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; 
            padding: 12px 20px; font-size: 14px; 
        } 
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); } 
 
        /* Search & Reset Section */ 
        .management-section { 
            background: #f8f9fa; padding: 25px; 
            border-radius: 15px; margin-bottom: 30px; 
            display: grid; grid-template-columns: 2fr 1fr 1fr; 
            gap: 20px; 
        } 
        .management-section h3 { margin-bottom: 15px; color: #333; } 
        #searchEmployee { 
            width: 100%; padding: 15px; border: 2px solid #e1e5e9; 
            border-radius: 10px; font-size: 16px; 
        } 
        #searchEmployee:focus { 
            outline: none; border-color: #4facfe; 
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1); 
        } 
        .employee-stats-card { 
            margin-top: 15px; padding: 15px; background: white; 
            border-radius: 10px; display: none; 
            text-align: left; 
        } 
        .management-section .btn { width: 100%; margin-top: 0; } 
 
        /* Transaction History */ 
        .transactions { 
            background: white; border-radius: 15px; 
            padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
        } 
        .transactions h3 { margin-bottom: 20px; color: #333; font-size: 1.5em; } 
        .transaction-list { max-height: 500px; overflow-y: auto; } 
 
        /* Added for grouping by date */ 
        .transaction-date-group { 
            margin-bottom: 25px; 
            border: 1px solid #e0e0e0; 
            border-radius: 10px; 
            overflow: hidden; 
        } 
        .transaction-date-group h4 { 
            background: #f0f0f0; 
            padding: 10px 20px; 
            margin: 0; 
            border-bottom: 1px solid #e0e0e0; 
            font-size: 1.1em; 
            color: #555; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        } 
        .transaction-date-group h4 span.daily-total { 
            font-weight: bold; 
            color: #2c3e50; 
        } 
 
        .transaction-item { 
            display: flex; justify-content: space-between; 
            align-items: center; padding: 15px 20px; margin-bottom: 0; 
            background: linear-gradient(135deg, #ffffff 0%, #fefefe 100%); 
            border-radius: 0; 
            border-left: 5px solid #4facfe; 
            border-bottom: 1px solid #eee; 
            cursor: pointer; transition: all 0.2s ease; 
        } 
        .transaction-item:last-child { 
            border-bottom: none; 
        } 
        .transaction-item:hover { 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            transform: translateY(-1px); border-left: 5px solid #00f2fe; 
        } 
        .transaction-info { 
            text-align: left; 
        } 
        .transaction-info h4 { 
            color: #333; margin-bottom: 5px; font-size: 1.1em; 
        } 
        .transaction-info p { 
            margin: 0; font-size: 0.9em; color: #555; 
        } 
        .transaction-amount.add { color: #27ae60; font-weight: bold; font-size: 1.1em; } 
        .transaction-amount.subtract { color: #e74c3c; font-weight: bold; font-size: 1.1em; } 
        .date { color: #7f8c8d; font-size: 0.8em; margin-top: 5px;} 
        .no-data { 
            text-align: center; color: #7f8c8d; 
            font-style: italic; padding: 40px; 
        } 
        .paid-status { 
            font-size: 0.8em; 
            font-weight: 600; 
            padding: 3px 8px; 
            border-radius: 5px; 
            color: white; 
            display: inline-block; 
            margin-left: 10px; 
        } 
        .paid-status.paid { 
            background-color: #28a745; 
        } 
        .paid-status.unpaid { 
            background-color: #ffc107; 
        } 
 
        /* Border for "X√°c nh·∫≠n ƒë∆°n t·ªïng ti·ªÅn t·ª´ng ng√†y" */ 
        .confirmation-border { 
            border: 2px solid #28a745; 
            border-radius: 10px; 
            padding: 15px; 
            margin-bottom: 20px; 
            background: #f8f9fa; 
        } 
        .confirmation-border h4 { 
            margin: 0; color: #28a745; font-size: 1.2em; 
            display: flex; justify-content: space-between; 
            align-items: center; 
        } 
        .confirmation-border .total-amount { 
            font-weight: bold; color: #27ae60; 
        } 
 
        /* Order Statistics */ 
        .order-stats { 
            display: flex; justify-content: space-around; margin-bottom: 20px; 
            background: #f8f9fa; border-radius: 10px; padding: 15px; 
            border: 2px solid #28a745; 
        } 
        .order-stats .stat-item { 
            text-align: center; 
        } 
        .order-stats .stat-item h4 { 
            margin: 0; font-size: 1.2em; color: #28a745; 
        } 
        .order-stats .stat-item p { 
            margin: 5px 0 0; font-size: 1.5em; font-weight: bold; 
            color: #27ae60; 
        } 
 
        /* Paid Orders Section */ 
        .paid-orders-section { 
            margin-top: 30px; 
            border: 2px solid #28a745; 
            border-radius: 10px; 
            padding: 20px; 
            background: #e8f5e9; 
        } 
        .paid-orders-section h3 { 
            margin: 0 0 15px 0; color: #28a745; font-size: 1.5em; 
            display: flex; justify-content: space-between; 
            align-items: center; 
        } 
        .paid-orders-section .order-list { 
            max-height: 400px; overflow-y: auto; 
        } 
        .paid-orders-section .transaction-item { 
            border-left: 5px solid #28a745; 
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); 
        } 
        .paid-orders-section .transaction-item:hover { 
            border-left: 5px solid #20c997; 
        } 
 
        /* Unpaid Orders Section */ 
        .unpaid-orders-section { 
            margin-top: 30px; 
            border: 2px solid #ffc107; 
            border-radius: 10px; 
            padding: 20px; 
            background: #fff3cd; 
        } 
        .unpaid-orders-section h3 { 
            margin: 0 0 15px 0; color: #ffc107; font-size: 1.5em; 
            display: flex; justify-content: space-between; 
            align-items: center; 
        } 
        .unpaid-orders-section .order-list { 
            max-height: 400px; overflow-y: auto; 
        } 
        .unpaid-orders-section .transaction-item { 
            border-left: 5px solid #ffc107; 
            background: linear-gradient(135deg, #fff8e1 0%, #fff3cd 100%); 
        } 
        .unpaid-orders-section .transaction-item:hover { 
            border-left: 5px solid #e0b100; 
        } 
 
        /* Dialogs */ 
        .overlay { 
            position: fixed; top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 999; display: none; 
        } 
        .confirm-dialog, .edit-transaction-dialog, .employee-detail-dialog, .add-order-dialog { 
            position: fixed; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); background: white; 
            padding: 30px; border-radius: 15px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); 
            z-index: 1000; display: none; max-width: 600px; text-align: center; 
        } 
        .edit-transaction-dialog .input-group, .employee-detail-dialog .input-group, .add-order-dialog .input-group { margin-bottom: 15px; } 
        .edit-transaction-dialog .btn-group, .employee-detail-dialog .btn-group, .add-order-dialog .btn-group { 
            display: flex; justify-content: center; gap: 10px; margin-top: 20px; 
        } 
        .edit-transaction-dialog input[type="text"], .edit-transaction-dialog input[type="number"], 
        .employee-detail-dialog input[type="text"], .employee-detail-dialog input[type="number"], 
        .edit-transaction-dialog .checkbox-group label, .employee-detail-dialog .checkbox-group label, .add-order-dialog .checkbox-group label { width: 100%; } 
 
        .employee-detail-dialog .detail-list { 
            max-height: 400px; 
            overflow-y: auto; 
            text-align: left; 
            margin-top: 20px; 
            padding-right: 10px; 
        } 
        .employee-detail-dialog .detail-list h4 { 
            margin-top: 15px; 
            margin-bottom: 10px; 
            color: #333; 
            font-size: 1.2em; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 5px; 
        } 
        .employee-detail-dialog .detail-list ul { 
            list-style: none; 
            padding: 0; 
        } 
        .employee-detail-dialog .detail-list ul li { 
            background: #f8f8f8; 
            padding: 10px; 
            margin-bottom: 8px; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        } 
        .employee-detail-dialog .detail-list ul li span { 
            color: #555; 
            font-size: 0.9em; 
        } 
        .employee-detail-dialog .detail-list ul li .amount { 
            font-weight: bold; 
            color: #28a745; 
        } 
        .employee-detail-dialog .summary-info { 
            text-align: left; 
            margin-bottom: 20px; 
            padding-bottom: 10px; 
            border-bottom: 1px solid #ddd; 
        } 
        .employee-detail-dialog .summary-info p { 
            margin: 5px 0; 
            font-size: 1em; 
            color: #444; 
        } 
        .employee-detail-dialog .summary-info .total-amount { 
            font-size: 1.3em; 
            font-weight: bold; 
            color: #27ae60; 
            margin-top: 10px; 
        } 
 
        /* Add Order Dialog */ 
        .add-order-dialog .order-list { 
            max-height: 300px; 
            overflow-y: auto; 
            margin-bottom: 20px; 
            border: 1px solid #eee; 
            border-radius: 8px; 
            padding: 10px; 
        } 
        .add-order-dialog .order-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px; margin-bottom: 8px; 
            background: #f8f9fa; border-radius: 6px; 
            border-left: 4px solid #4facfe; 
        } 
        .add-order-dialog .order-item:last-child { 
            margin-bottom: 0; 
        } 
        .add-order-dialog .order-item .amount { 
            font-weight: bold; color: #27ae60; 
        } 
        .add-order-dialog .order-item .actions { 
            display: flex; gap: 5px; 
        } 
        .add-order-dialog .order-item .actions button { 
            padding: 5px 10px; font-size: 12px; 
        } 
        .add-order-dialog .total-row { 
            display: flex; justify-content: space-between; 
            font-weight: bold; color: #27ae60; 
            padding: 10px; background: #f0f0f0; 
            border-radius: 6px; 
            margin-top: 10px; 
        } 
        .add-order-dialog .total-row .total-amount { 
            font-size: 1.2em; 
        } 
 
        /* Responsive */ 
        @media (max-width: 768px) { 
            .input-section, .management-section { grid-template-columns: 1fr; } 
            .btn { width: 100%; } 
        } 
    </style> 
</head> 
<body> 
    <!-- üîê M√ÄN H√åNH ƒêƒÇNG NH·∫¨P - HI·ªÜN L√äN TR∆Ø·ªöC --> 
    <div class="login-overlay" id="loginScreen"> 
        <div class="login-container"> 
            <h2>üîê ƒêƒÉng nh·∫≠p Qu·∫£n l√Ω ƒê∆°n h√†ng</h2> 
            <div class="login-input-group"> 
                <label>üì± M·∫≠t kh·∫©u qu·∫£n tr·ªã:</label> 
                <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ truy c·∫≠p"> 
            </div> 
            <button class="login-btn" onclick="checkPassword()">üöÄ Truy c·∫≠p h·ªá th·ªëng</button> 
            <div class="login-error" id="loginError">‚ùå M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!</div> 
        </div> 
    </div> 
 
    <!-- N√öT ƒêƒÇNG XU·∫§T (ch·ªâ hi·ªán khi ƒë√£ login) --> 
    <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">üö™ Tho√°t</button> 
 
    <div class="overlay" id="overlay"></div> 
 
    <!-- Dialog x√°c nh·∫≠n chung --> 
    <div class="confirm-dialog" id="confirmDialog"> 
        <h3 id="confirmTitle">X√°c nh·∫≠n</h3> 
        <p id="confirmMessage"></p> 
        <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: center;"> 
            <button class="btn btn-delete" id="confirmActionBtn" style="width: 120px;">X√°c nh·∫≠n</button> 
            <button class="btn" onclick="closeDialog('confirmDialog')" style="background: #6c757d; width: 120px;">H·ªßy</button> 
        </div> 
    </div> 
 
    <!-- Dialog ch·ªânh s·ª≠a/th√™m/tr·ª´ ti·ªÅn cho m·ªôt ƒë∆°n h√†ng --> 
    <div class="edit-transaction-dialog" id="editTransactionDialog"> 
        <h3>Ch·ªânh s·ª≠a ƒë∆°n h√†ng</h3> 
        <div class="input-group"> 
            <label>T√™n nh√¢n vi√™n:</label> 
            <input type="text" id="editEmployeeName" readonly> 
        </div> 
        <div class="input-group"> 
            <label>M√¥ t·∫£ ƒë∆°n h√†ng g·ªëc:</label> 
            <textarea id="editTransactionDescription" rows="3" readonly style="resize: vertical;"></textarea> 
        </div> 
        <div class="input-group"> 
            <label>S·ªë ti·ªÅn hi·ªán t·∫°i:</label> 
            <input type="text" id="editCurrentAmount" readonly> 
        </div> 
        <div class="input-group checkbox-group"> 
            <input type="checkbox" id="editIsPaidCheckbox"> 
            <label for="editIsPaidCheckbox" style="margin: 0;">ƒê√£ tr·∫£ ƒë∆°n</label> 
        </div> 
        <div class="input-group"> 
            <label>Nh·∫≠p s·ªë ti·ªÅn ƒëi·ªÅu ch·ªânh (v√≠ d·ª•: 10,-20 ho·∫∑c 5,10):</label> 
            <input type="text" id="adjustmentAmount" placeholder="10,20 ho·∫∑c -50"> 
        </div> 
        <div class="btn-group"> 
            <button class="btn" style="background: #56ab2f;" onclick="adjustTransactionAmount('add')" >‚ûï C·ªông ti·ªÅn</button> 
            <button class="btn" style="background: #ff6b6b;" onclick="adjustTransactionAmount('subtract')" >‚ûñ Tr·ª´ ti·ªÅn</button> 
        </div> 
        <div class="btn-group" style="margin-top: 10px;"> 
            <button class="btn btn-delete" onclick="deleteSingleTransaction()" >üóëÔ∏è X√≥a ƒë∆°n n√†y</button> 
            <button class="btn" onclick="closeDialog('editTransactionDialog')" style="background: #6c757d;" >ƒê√≥ng</button> 
        </div> 
    </div> 
 
    <!-- Dialog hi·ªÉn th·ªã chi ti·∫øt l·ªãch s·ª≠ nh√¢n vi√™n --> 
    <div class="employee-detail-dialog" id="employeeDetailDialog"> 
        <h3 id="employeeDetailName"></h3> 
        <div class="summary-info"> 
            <p class="total-amount"><strong>T·ªïng ti·ªÅn t√≠ch g√≥p:</strong> <span id="employeeDetailTotalAmount"></span></p> 
        </div> 
        <div class="detail-list" id="employeeDetailList"> 
            <!-- Daily transactions will be inserted here --> 
        </div> 
        <div class="btn-group"> 
            <button class="btn" onclick="closeDialog('employeeDetailDialog')" style="background: #6c757d;">ƒê√≥ng</button> 
        </div> 
    </div> 
 
    <!-- Dialog th√™m ƒë∆°n h√†ng con --> 
    <div class="add-order-dialog" id="addOrderDialog"> 
        <h3>Th√™m ƒë∆°n h√†ng cho nh√¢n vi√™n: <span id="currentEmployeeName"></span></h3> 
        <div class="order-list" id="orderList"> 
            <!-- C√°c ƒë∆°n h√†ng con s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y --> 
        </div> 
        <div class="input-group"> 
            <label>üí∞ TH√äM TI·ªÄN HO·∫∂C C·ªòNG TI·ªÄN (+10 ƒë·ªÉ c·ªông, -10 ƒë·ªÉ tr·ª´):</label> 
            <input type="text" id="newOrderAmount" placeholder="+10 ho·∫∑c -50"> 
            <div class="input-hint">G·ª£i √Ω: +10 ƒë·ªÉ c·ªông ti·ªÅn, -10 ƒë·ªÉ tr·ª´ ti·ªÅn</div> 
        </div> 
        <div class="btn-group"> 
            <button class="btn btn-save-order" onclick="addNewOrder()">‚ûï Th√™m ƒë∆°n</button> 
            <button class="btn" onclick="confirmPaymentFromDialog()" style="background: #28a745; color: white;">‚úÖ ƒê√£ Tr·∫£ Ti·ªÅn</button> 
            <button class="btn" onclick="closeDialog('addOrderDialog')" style="background: #6c757d;">ƒê√≥ng</button> 
        </div> 
    </div> 
 
    <!-- APP CH√çNH - ·∫®N KHI CH∆ØA LOGIN --> 
    <div class="container app-hidden" id="mainApp"> 
        <div class="header"> 
            <h1>üìä Qu·∫£n L√Ω ƒê∆°n H√†ng Nh√¢n Vi√™n</h1> 
            <p>T·ªïng h√¥m nay: <span id="todayTotal">0 VNƒê</span></p> 
        </div> 
 
        <div class="main-content"> 
            <!-- Ph·∫ßn nh·∫≠p ƒë∆°n h√†ng m·ªõi --> 
            <div class="input-section"> 
                <div class="input-group"> 
                    <label>üîπ T√™n nh√¢n vi√™n:</label> 
                    <input type="text" id="employeeName" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n" autocomplete="off"> 
                </div> 
                <div class="input-group"> 
                    <label>üë®‚Äçüíº H·ªç t√™n kh√°ch h√†ng:</label> 
                    <input type="text" id="customerName" placeholder="Nh·∫≠p h·ªç t√™n kh√°ch h√†ng"> 
                </div> 
                <div class="input-group"> 
                    <label>üè† ƒê·ªãa ch·ªâ kh√°ch h√†ng:</label> 
                    <input type="text" id="customerAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ kh√°ch h√†ng"> 
                </div> 
                <div class="input-group"> 
                    <label>üìû S·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng:</label> 
                    <input type="text" id="customerPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng"> 
                </div> 
                <div class="input-group"> 
                    <label>üí∞ S·ªë ti·ªÅn c·ªßa kh√°ch h√†ng (VNƒê):</label> 
                    <input type="number" id="orderAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn kh√°ch h√†ng thanh to√°n" min="0"> 
                    <div class="input-hint">Nh·∫≠p s·ªë ti·ªÅn th·ª±c t·∫ø kh√°ch h√†ng thanh to√°n</div> 
                </div> 
                <div class="input-group" style="grid-column: span 2; display: flex; justify-content: center;"> 
                    <button class="btn btn-save-order" onclick="saveOrder()"> 
                        üíæ Th√™m ƒë∆°n 
                    </button> 
                    <button class="btn" onclick="openAddOrderDialog()" style="background: #ffc107; margin-left: 10px;"> 
                        üìù Ch·ªët ƒë∆°n 
                    </button> 
                </div> 
            </div> 
 
            <!-- Ph·∫ßn qu·∫£n l√Ω: T√¨m ki·∫øm, X√≥a NV, Reset D·ªØ li·ªáu --> 
            <div class="management-section"> 
                <div> 
                    <h3>üîç T√¨m l·ªãch s·ª≠ nh√¢n vi√™n</h3> 
                    <input type="text" id="searchEmployee" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n ƒë·ªÉ xem l·ªãch s·ª≠..." 
                           oninput="filterEmployeeHistory()"> 
                    <div id="employeeStats" class="employee-stats-card"></div> 
                </div> 
                <div> 
                    <h3 style="color: #e74c3c;">üóëÔ∏è X√≥a nh√¢n vi√™n</h3> 
                    <input type="text" id="employeeToDelete" placeholder="Nh·∫≠p t√™n NV ƒë·ªÉ x√≥a to√†n b·ªô ƒë∆°n..."> 
                    <button class="btn btn-delete" onclick="deleteEmployee()"> 
                        X√≥a to√†n b·ªô NV n√†y 
                    </button> 
                </div> 
                <div> 
                    <h3 style="color: #6c757d;">üîÑ ƒê·∫∑t l·∫°i d·ªØ li·ªáu</h3> 
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">X√≥a to√†n b·ªô d·ªØ li·ªáu (c·∫©n th·∫≠n!)</p> 
                    <button class="btn" style="background: #6c757d;" onclick="resetAllData()"> 
                        X√≥a to√†n b·ªô d·ªØ li·ªáu 
                    </button> 
                </div> 
            </div> 
 
            <!-- Ch·ªâ hi·ªÉn th·ªã khi t√¨m ki·∫øm l·ªãch s·ª≠ --> 
            <div class="transactions" id="transactionSection" style="display: none;"> 
                <h3>üìã L·ªãch s·ª≠ ƒë∆°n h√†ng c·ªßa nh√¢n vi√™n</h3> 
                <div class="transaction-list" id="transactionList"> 
                    <div class="no-data">Nh·∫≠p t√™n nh√¢n vi√™n ƒë·ªÉ xem l·ªãch s·ª≠...</div> 
                </div> 
            </div> 
        </div> 
    </div> 
 
    <script> 
        let paidTransactions = JSON.parse(localStorage.getItem('paidEmployeeTransactions')) || []; 
        let unpaidTransactions = JSON.parse(localStorage.getItem('unpaidEmployeeTransactions')) || []; 
        let pendingTransactions = JSON.parse(localStorage.getItem('pendingEmployeeTransactions')) || []; 
        let orderStatistics = JSON.parse(localStorage.getItem('orderStatistics')) || {}; 
        let currentEmployeeOrders = []; // Danh s√°ch c√°c ƒë∆°n h√†ng ƒëang ch·ªù c·ªßa nh√¢n vi√™n hi·ªán t·∫°i 
        let currentEmployeeName = ''; // T√™n nh√¢n vi√™n ƒëang ƒë∆∞·ª£c ch·ªët ƒë∆°n 
        let editingTransactionId = null; 
 
        // üî• üî• üî• PH·∫¶N M·∫¨T KH·∫®U - ƒê·ªîI M·∫¨T KH·∫®U T·∫†I ƒê√ÇY üî• üî• üî• 
        const ADMIN_PASSWORD = "0965579926"; // üëà ƒê·ªîI M·∫¨T KH·∫®U C·ª¶A B·∫†N V√ÄO ƒê√ÇY 
 
        // Ki·ªÉm tra ƒëƒÉng nh·∫≠p 
        function checkPassword() { 
            const password = document.getElementById('loginPassword').value; 
            const errorDiv = document.getElementById('loginError'); 
 
            if (password === ADMIN_PASSWORD) { 
                // ƒê√öNG M·∫¨T KH·∫®U ‚Üí HI·ªÜN APP, ·∫®N LOGIN 
                document.getElementById('loginScreen').style.display = 'none'; 
                document.getElementById('mainApp').classList.remove('app-hidden'); 
                document.getElementById('logoutBtn').style.display = 'block'; 
                document.getElementById('loginPassword').value = ''; // X√≥a input 
                alert('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch√†o m·ª´ng ƒë·∫øn h·ªá th·ªëng qu·∫£n l√Ω.'); 
                initApp(); // Kh·ªüi t·∫°o app 
            } else { 
                // SAI M·∫¨T KH·∫®U ‚Üí HI·ªÜN L·ªñI 
                errorDiv.style.display = 'block'; 
                document.getElementById('loginPassword').value = ''; 
                document.getElementById('loginPassword').focus(); 
                setTimeout(() => errorDiv.style.display = 'none', 3000); 
            } 
        } 
 
        // ƒêƒÉng xu·∫•t 
        function logout() { 
            if (confirm('üö™ B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) { 
                document.getElementById('loginScreen').style.display = 'flex'; 
                document.getElementById('mainApp').classList.add('app-hidden'); 
                document.getElementById('logoutBtn').style.display = 'none'; 
                paidTransactions = []; // X√≥a d·ªØ li·ªáu t·∫°m th·ªùi 
                unpaidTransactions = []; 
                pendingTransactions = []; 
                orderStatistics = {}; 
                currentEmployeeOrders = []; 
                localStorage.clear(); // X√ìA TO√ÄN B·ªò localStorage 
            } 
        } 
 
        // Enter ƒë·ªÉ ƒëƒÉng nh·∫≠p nhanh 
        document.getElementById('loginPassword').addEventListener('keypress', function(e) { 
            if (e.key === 'Enter') checkPassword(); 
        }); 
 
        // --- H√†m h·ªó tr·ª£ --- 
        function parseAmountWithSign(inputString) { 
            if (!inputString || inputString.trim() === '') return 0; 
 
            // Lo·∫°i b·ªè t·∫•t c·∫£ k√Ω t·ª± kh√¥ng ph·∫£i s·ªë v√† d·∫•u +/- 
            const cleanString = inputString.replace(/[^\d\+\-]/g, ''); 
             
            // N·∫øu kh√¥ng c√≥ d·∫•u + ho·∫∑c -, m·∫∑c ƒë·ªãnh l√† d∆∞∆°ng 
            if (!cleanString.includes('+') && !cleanString.includes('-')) { 
                return parseInt(cleanString) || 0; 
            } 
 
            // X·ª≠ l√Ω chu·ªói c√≥ d·∫•u 
            let sum = 0; 
            const parts = cleanString.split(/[,\s]/).filter(part => part.trim() !== ''); 
             
            parts.forEach(part => { 
                const num = parseInt(part); 
                if (!isNaN(num)) { 
                    sum += num; 
                } 
            }); 
             
            return sum; 
        } 
 
        function formatCurrency(amount) { 
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND' 
            }).format(Math.abs(amount)); 
        } 
 
        function getTodayDate() { 
            return new Date().toISOString().split('T')[0]; 
        } 
 
        function getFormattedDate(dateString) { 
            const date = new Date(dateString); 
            return date.toLocaleDateString('vi-VN', { 
                day: '2-digit', month: '2-digit', year: 'numeric' 
            }); 
        } 
 
        function calculateTodayTotal() { 
            const today = getTodayDate(); 
            return paidTransactions 
                .filter(t => t.date === today) 
                .reduce((sum, t) => sum + t.orderAmount, 0); 
        } 
 
        function updateStats() { 
            document.getElementById('todayTotal').textContent = formatCurrency(calculateTodayTotal()); 
        } 
 
        // --- C·∫≠p nh·∫≠t th·ªëng k√™ ƒë∆°n h√†ng --- 
        function updateOrderStatistics() { 
            // T√≠nh to√°n s·ªë ƒë∆°n ƒë√£ thanh to√°n v√† s·ªë ƒë∆°n n·ª£ cho t·ª´ng ng√†y 
            const today = getTodayDate(); 
            const todayDate = getFormattedDate(today); 
 
            // ƒê·∫∑t m·∫∑c ƒë·ªãnh cho ng√†y h√¥m nay n·∫øu ch∆∞a c√≥ 
            if (!orderStatistics[today]) { 
                orderStatistics[today] = { 
                    confirmedOrders: 0, 
                    outstandingOrders: 0, 
                    totalOrders: 0, 
                    date: todayDate 
                }; 
            } 
 
            // C·∫≠p nh·∫≠t s·ªë ƒë∆°n ƒë√£ thanh to√°n (isPaid = true) 
            const confirmedOrders = paidTransactions.filter(t => t.date === today).length; 
            orderStatistics[today].confirmedOrders = confirmedOrders; 
 
            // C·∫≠p nh·∫≠t s·ªë ƒë∆°n n·ª£ (isPaid = false) 
            const outstandingOrders = unpaidTransactions.filter(t => t.date === today).length; 
            orderStatistics[today].outstandingOrders = outstandingOrders; 
 
            // T·ªïng s·ªë ƒë∆°n 
            orderStatistics[today].totalOrders = confirmedOrders + outstandingOrders; 
 
            // L∆∞u v√†o localStorage 
            localStorage.setItem('orderStatistics', JSON.stringify(orderStatistics)); 
 
            // C·∫≠p nh·∫≠t giao di·ªán th·ªëng k√™ 
            updateOrderStatisticsUI(); 
        } 
 
        // --- C·∫≠p nh·∫≠t giao di·ªán th·ªëng k√™ --- 
        function updateOrderStatisticsUI() { 
            const today = getTodayDate(); 
            const todayDate = getFormattedDate(today); 
 
            const stats = orderStatistics[today] || { 
                confirmedOrders: 0, 
                outstandingOrders: 0, 
                totalOrders: 0, 
                date: todayDate 
            }; 
 
            const orderStats = document.getElementById('orderStats'); 
            if (orderStats) { 
                orderStats.innerHTML = ` 
                    <div class="order-stats"> 
                        <div class="stat-item"> 
                            <h4>S·ªë ƒë∆°n ƒë√£ thanh to√°n</h4> 
                            <p>${stats.confirmedOrders}</p> 
                        </div> 
                        <div class="stat-item"> 
                            <h4>S·ªë ƒë∆°n n·ª£</h4> 
                            <p>${stats.outstandingOrders}</p> 
                        </div> 
                        <div class="stat-item"> 
                            <h4>T·ªïng s·ªë ƒë∆°n</h4> 
                            <p>${stats.totalOrders}</p> 
                        </div> 
                    </div> 
                `; 
            } 
        } 
 
        // --- Hi·ªÉn th·ªã giao d·ªãch (ch·ªâ khi t√¨m ki·∫øm) --- 
        function displayTransactions(filteredTrans = null) { 
            const list = document.getElementById('transactionList'); 
            let transactionsToDisplay = filteredTrans; 
 
            if (!transactionsToDisplay || transactionsToDisplay.length === 0) { 
                list.innerHTML = '<div class="no-data">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o cho nh√¢n vi√™n n√†y.</div>'; 
                return; 
            } 
 
            transactionsToDisplay.sort((a, b) => b.id - a.id); 
 
            // Group transactions by date 
            const groupedByDate = transactionsToDisplay.reduce((acc, t) => { 
                const date = t.date; 
                if (!acc[date]) { 
                    acc[date] = []; 
                } 
                acc[date].push(t); 
                return acc; 
            }, {}); 
 
            let html = ''; 
            for (const date in groupedByDate) { 
                const dailyTransactions = groupedByDate[date].sort((a, b) => b.id - a.id); 
                const dailyTotal = dailyTransactions.reduce((sum, t) => sum + t.orderAmount, 0); 
                const formattedDate = new Date(date).toLocaleDateString('vi-VN', { 
                    day: '2-digit', month: '2-digit', year: 'numeric' 
                }); 
 
                html += ` 
                    <div class="transaction-date-group"> 
                        <h4>Ng√†y ${formattedDate} <span class="daily-total">T·ªïng ng√†y: ${formatCurrency(dailyTotal)}</span></h4> 
                        <div> 
                `; 
                html += dailyTransactions.map(t => ` 
                    <div class="transaction-item" onclick="openEditTransactionDialog(${t.id})"> 
                        <div class="transaction-info"> 
                            <h4>${t.employeeName} 
                                <span class="paid-status ${t.isPaid ? 'paid' : 'unpaid'}"> 
                                    ${t.isPaid ? 'ƒê√£ tr·∫£' : 'Ch∆∞a tr·∫£'} 
                                </span> 
                            </h4> 
                            <p><strong>Kh√°ch:</strong> ${t.customerName || 'N/A'}</p> 
                            <p><strong>SƒêT:</strong> ${t.customerPhone || 'N/A'}</p> 
                            <p style="font-size: 0.85em; color: #666;">${t.description}</p> 
                            <div class="date">${new Date(t.date + 'T' + t.time).toLocaleTimeString('vi-VN')}</div> 
                        </div> 
                        <div class="transaction-amount ${t.orderAmount >= 0 ? 'add' : 'subtract'}"> 
                            +${formatCurrency(t.orderAmount)} 
                        </div> 
                    </div> 
                `).join(''); 
                html += ` 
                        </div> 
                    </div> 
                `; 
            } 
 
            list.innerHTML = html; 
        } 
 
        // Kh·ªüi t·∫°o app sau khi login 
        function initApp() { 
            // Load l·∫°i d·ªØ li·ªáu t·ª´ localStorage 
            const savedPaidTransactions = localStorage.getItem('paidEmployeeTransactions'); 
            if (savedPaidTransactions) { 
                paidTransactions = JSON.parse(savedPaidTransactions); 
            } 
            const savedUnpaidTransactions = localStorage.getItem('unpaidEmployeeTransactions'); 
            if (savedUnpaidTransactions) { 
                unpaidTransactions = JSON.parse(savedUnpaidTransactions); 
            } 
            const savedPendingTransactions = localStorage.getItem('pendingEmployeeTransactions'); 
            if (savedPendingTransactions) { 
                pendingTransactions = JSON.parse(savedPendingTransactions); 
            } 
            const savedOrderStatistics = localStorage.getItem('orderStatistics'); 
            if (savedOrderStatistics) { 
                orderStatistics = JSON.parse(savedOrderStatistics); 
            } 
            updateStats(); 
            updateOrderStatisticsUI(); 
            // Kh√¥ng hi·ªÉn th·ªã l·ªãch s·ª≠ m·∫∑c ƒë·ªãnh, ch·ªâ khi t√¨m ki·∫øm 
            document.getElementById('transactionSection').style.display = 'none'; 
        } 
 
        // L∆∞u ƒë∆°n h√†ng m·ªõi 
        function saveOrder() { 
            const employeeName = document.getElementById('employeeName').value.trim(); 
            const customerName = document.getElementById('customerName').value.trim(); 
            const customerAddress = document.getElementById('customerAddress').value.trim(); 
            const customerPhone = document.getElementById('customerPhone').value.trim(); 
            const orderAmountInput = document.getElementById('orderAmount').value.trim(); 
 
            const totalOrderAmount = parseInt(orderAmountInput) || 0; 
 
            if (!employeeName) { 
                alert('‚ùå Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n!'); 
                return; 
            } 
            if (totalOrderAmount <= 0) { 
                alert('‚ùå S·ªë ti·ªÅn c·ªßa kh√°ch h√†ng ph·∫£i l·ªõn h∆°n 0!'); 
                return; 
            } 
 
            const transaction = { 
                id: Date.now(), 
                employeeName: employeeName, 
                customerName: customerName, 
                customerAddress: customerAddress, 
                customerPhone: customerPhone, 
                orderAmount: totalOrderAmount, 
                isPaid: false, // M·∫∑c ƒë·ªãnh l√† ch∆∞a tr·∫£ 
                date: getTodayDate(), 
                time: new Date().toLocaleTimeString('vi-VN'), 
                description: `Kh√°ch: ${customerName || 'N/A'}, SƒêT: ${customerPhone || 'N/A'}, ƒê·ªãa ch·ªâ: ${customerAddress || 'N/A'}` 
            }; 
 
            pendingTransactions.unshift(transaction); 
            localStorage.setItem('pendingEmployeeTransactions', JSON.stringify(pendingTransactions)); 
 
            alert(`‚úÖ ƒê√£ l∆∞u ƒë∆°n h√†ng CH∆ØA TR·∫¢ cho nh√¢n vi√™n ${employeeName}:\nS·ªë ti·ªÅn kh√°ch h√†ng: +${formatCurrency(totalOrderAmount)}\n(${orderAmountInput})`); 
 
            updateStats(); 
            updateOrderStatistics(); 
            clearInputs(); 
        } 
 
        // M·ªü dialog th√™m ƒë∆°n h√†ng con 
        function openAddOrderDialog() { 
            const employeeName = document.getElementById('employeeName').value.trim(); 
            if (!employeeName) { 
                alert('‚ùå Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n tr∆∞·ªõc khi ch·ªët ƒë∆°n!'); 
                return; 
            } 
 
            currentEmployeeName = employeeName; 
            document.getElementById('currentEmployeeName').textContent = employeeName; 
            document.getElementById('newOrderAmount').value = ''; 
 
            // Load c√°c ƒë∆°n h√†ng con hi·ªán c√≥ c·ªßa nh√¢n vi√™n n√†y 
            currentEmployeeOrders = pendingTransactions.filter(t => t.employeeName === employeeName && !t.isPaid); 
            displayCurrentEmployeeOrders(); 
 
            showDialog('addOrderDialog'); 
        } 
 
        // Hi·ªÉn th·ªã c√°c ƒë∆°n h√†ng con c·ªßa nh√¢n vi√™n hi·ªán t·∫°i 
        function displayCurrentEmployeeOrders() { 
            const orderList = document.getElementById('orderList'); 
            if (currentEmployeeOrders.length === 0) { 
                orderList.innerHTML = '<div style="color: #7f8c8d; font-style: italic; padding: 20px;">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</div>'; 
                return; 
            } 
 
            let html = ''; 
            let totalAmount = 0; 
            currentEmployeeOrders.forEach(order => { 
                const sign = order.orderAmount >= 0 ? '+' : ''; 
                html += ` 
                    <div class="order-item"> 
                        <div> 
                            <span>${new Date(order.date + 'T' + order.time).toLocaleString('vi-VN')}</span> 
                            <span style="color: #555;">${order.description}</span> 
                        </div> 
                        <div style="text-align: right;"> 
                            <span class="amount ${order.orderAmount >= 0 ? 'add' : 'subtract'}">${sign}${formatCurrency(order.orderAmount)}</span> 
                            <div class="actions"> 
                                <button class="btn btn-delete" onclick="removeOrder(${order.id})" style="padding: 5px 10px; font-size: 12px;">X√≥a</button> 
                            </div> 
                        </div> 
                    </div> 
                `; 
                totalAmount += order.orderAmount; 
            }); 
 
            const totalSign = totalAmount >= 0 ? '+' : ''; 
            html += ` 
                <div class="total-row"> 
                    <span>T·ªïng c·ªông:</span> 
                    <span class="total-amount ${totalAmount >= 0 ? 'add' : 'subtract'}">${totalSign}${formatCurrency(totalAmount)}</span> 
                </div> 
            `; 
 
            orderList.innerHTML = html; 
        } 
 
        // Th√™m ƒë∆°n h√†ng con m·ªõi 
        function addNewOrder() { 
            const newOrderAmountInput = document.getElementById('newOrderAmount').value.trim(); 
            const newOrderAmount = parseAmountWithSign(newOrderAmountInput); 
 
            if (newOrderAmount === 0) { 
                alert('‚ùå S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p ƒë√∫ng ƒë·ªãnh d·∫°ng (+10 ho·∫∑c -10)'); 
                return; 
            } 
 
            const newOrder = { 
                id: Date.now(), 
                employeeName: currentEmployeeName, 
                customerName: document.getElementById('customerName').value.trim(), 
                customerAddress: document.getElementById('customerAddress').value.trim(), 
                customerPhone: document.getElementById('customerPhone').value.trim(), 
                orderAmount: newOrderAmount, 
                isPaid: false, 
                date: getTodayDate(), 
                time: new Date().toLocaleTimeString('vi-VN'), 
                description: `Kh√°ch: ${document.getElementById('customerName').value.trim() || 'N/A'}, SƒêT: ${document.getElementById('customerPhone').value.trim() || 'N/A'}, ƒê·ªãa ch·ªâ: ${document.getElementById('customerAddress').value.trim() || 'N/A'}` 
            }; 
 
            currentEmployeeOrders.unshift(newOrder); 
            pendingTransactions.unshift(newOrder); 
            localStorage.setItem('pendingEmployeeTransactions', JSON.stringify(pendingTransactions)); 
 
            document.getElementById('newOrderAmount').value = ''; 
            displayCurrentEmployeeOrders(); 
 
            const sign = newOrderAmount >= 0 ? '+' : ''; 
            alert(`‚úÖ ƒê√£ th√™m ƒë∆°n h√†ng m·ªõi cho nh√¢n vi√™n ${currentEmployeeName}:\n${sign}${formatCurrency(newOrderAmount)}\n(${newOrderAmountInput})`); 
        } 
 
        // X√≥a ƒë∆°n h√†ng con 
        function removeOrder(orderId) { 
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng n√†y?')) { 
                currentEmployeeOrders = currentEmployeeOrders.filter(order => order.id !== orderId); 
                pendingTransactions = pendingTransactions.filter(order => order.id !== orderId); 
                localStorage.setItem('pendingEmployeeTransactions', JSON.stringify(pendingTransactions)); 
                displayCurrentEmployeeOrders(); 
            } 
        } 
 
        // Ch·ªët ƒë∆°n h√†ng t·ª´ dialog (ƒê√£ Tr·∫£ Ti·ªÅn) 
        function confirmPaymentFromDialog() { 
            if (currentEmployeeOrders.length === 0) { 
                alert('‚ùå Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o ƒë·ªÉ ch·ªët!'); 
                return; 
            } 
 
            const totalAmount = currentEmployeeOrders.reduce((sum, order) => sum + order.orderAmount, 0); 
            const totalSign = totalAmount >= 0 ? '+' : ''; 
 
            showConfirmDialog( 
                'X√°c nh·∫≠n ƒë√£ tr·∫£ ti·ªÅn', 
                `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë√°nh d·∫•u t·∫•t c·∫£ ${currentEmployeeOrders.length} ƒë∆°n h√†ng cho nh√¢n vi√™n ${currentEmployeeName} l√† "ƒê√£ Tr·∫£ Ti·ªÅn" v·ªõi t·ªïng s·ªë ti·ªÅn ${totalSign}${formatCurrency(totalAmount)} kh√¥ng?`, 
                () => { 
                    // C·∫≠p nh·∫≠t tr·∫°ng th√°i thanh to√°n cho t·∫•t c·∫£ c√°c ƒë∆°n h√†ng con 
                    currentEmployeeOrders.forEach(order => { 
                        order.isPaid = true; 
                    }); 
 
                    // Chuy·ªÉn t·∫•t c·∫£ c√°c ƒë∆°n h√†ng con t·ª´ pending sang paidTransactions 
                    paidTransactions.unshift(...currentEmployeeOrders); 
                    // X√≥a t·∫•t c·∫£ c√°c ƒë∆°n h√†ng con kh·ªèi pendingTransactions 
                    pendingTransactions = pendingTransactions.filter(t => !currentEmployeeOrders.some(co => co.id === t.id)); 
 
                    localStorage.setItem('paidEmployeeTransactions', JSON.stringify(paidTransactions)); 
                    localStorage.setItem('pendingEmployeeTransactions', JSON.stringify(pendingTransactions)); 
 
                    // C·∫≠p nh·∫≠t th·ªëng k√™ ƒë∆°n h√†ng 
                    updateOrderStatistics(); 
 
                    // C·∫≠p nh·∫≠t giao di·ªán 
                    updateStats(); 
                    currentEmployeeOrders = []; 
                    closeDialog('addOrderDialog'); 
                    clearInputs(); 
 
                    alert(`‚úÖ ƒê√£ ch·ªët t·∫•t c·∫£ ${currentEmployeeOrders.length} ƒë∆°n h√†ng ƒê√É TR·∫¢ cho nh√¢n vi√™n ${currentEmployeeName}:\nT·ªïng ti·ªÅn: ${totalSign}${formatCurrency(totalAmount)}`); 
                } 
            ); 
        } 
 
        function clearInputs() { 
            document.getElementById('employeeName').value = ''; 
            document.getElementById('customerName').value = ''; 
            document.getElementById('customerAddress').value = ''; 
            document.getElementById('customerPhone').value = ''; 
            document.getElementById('orderAmount').value = ''; 
            document.getElementById('employeeName').focus(); 
        } 
 
        function openEditTransactionDialog(id) { 
            editingTransactionId = id; 
            const transaction = paidTransactions.find(t => t.id === id) || unpaidTransactions.find(t => t.id === id); 
 
            if (!transaction) { 
                alert('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†y.'); 
                return; 
            } 
 
            document.getElementById('editEmployeeName').value = transaction.employeeName; 
            document.getElementById('editTransactionDescription').value = transaction.description; 
            document.getElementById('editCurrentAmount').value = `${transaction.orderAmount >= 0 ? '+' : ''}${formatCurrency(transaction.orderAmount)}`; 
            document.getElementById('editIsPaidCheckbox').checked = transaction.isPaid; 
            document.getElementById('adjustmentAmount').value = ''; 
 
            showDialog('editTransactionDialog'); 
        } 
 
        function adjustTransactionAmount(actionType) { 
            if (!editingTransactionId) return; 
 
            const paidTransactionIndex = paidTransactions.findIndex(t => t.id === editingTransactionId); 
            const unpaidTransactionIndex = unpaidTransactions.findIndex(t => t.id === editingTransactionId); 
            let transactionIndex = -1; 
            let transactionArray = null; 
 
            if (paidTransactionIndex !== -1) { 
                transactionIndex = paidTransactionIndex; 
                transactionArray = paidTransactions; 
            } else if (unpaidTransactionIndex !== -1) { 
                transactionIndex = unpaidTransactionIndex; 
                transactionArray = unpaidTransactions; 
            } 
 
            if (transactionIndex === -1) { 
                alert('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ƒë·ªÉ ch·ªânh s·ª≠a.'); 
                return; 
            } 
 
            const adjustmentInput = document.getElementById('adjustmentAmount').value.trim(); 
            const adjustmentValue = parseInt(adjustmentInput) || 0; 
            const isPaidAfterEdit = document.getElementById('editIsPaidCheckbox').checked; 
 
            if (adjustmentInput === '' && transactionArray[transactionIndex].isPaid === isPaidAfterEdit) { 
                alert('‚ùå Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn ƒëi·ªÅu ch·ªânh ho·∫∑c thay ƒë·ªïi tr·∫°ng th√°i thanh to√°n!'); 
                return; 
            } 
            if (adjustmentInput !== '' && adjustmentValue === 0) { 
                alert('‚ùå S·ªë ti·ªÅn ƒëi·ªÅu ch·ªânh kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p ƒë√∫ng ƒë·ªãnh d·∫°ng (+10 ho·∫∑c -10)'); 
                return; 
            } 
 
            let currentAmount = transactionArray[transactionIndex].orderAmount; 
            let newAmount = currentAmount; 
 
            if (adjustmentInput !== '') { 
                if (actionType === 'add') { 
                    newAmount = currentAmount + Math.abs(adjustmentValue); 
                } else if (actionType === 'subtract') { 
                    newAmount = currentAmount - Math.abs(adjustmentValue); 
                } 
            } 
 
            // C·∫≠p nh·∫≠t transaction 
            transactionArray[transactionIndex].orderAmount = newAmount; 
            transactionArray[transactionIndex].isPaid = isPaidAfterEdit; 
            transactionArray[transactionIndex].time = new Date().toLocaleTimeString('vi-VN'); 
            if (adjustmentInput !== '') { 
                transactionArray[transactionIndex].description += ` | ƒêi·ªÅu ch·ªânh (${actionType === 'add' ? '+' : '-'}${adjustmentInput})`; 
            } 
 
            // L∆∞u v√†o localStorage 
            if (transactionArray === paidTransactions) { 
                localStorage.setItem('paidEmployeeTransactions', JSON.stringify(paidTransactions)); 
            } else { 
                localStorage.setItem('unpaidEmployeeTransactions', JSON.stringify(unpaidTransactions)); 
            } 
 
            updateStats(); 
            updateOrderStatistics(); 
            if (document.getElementById('searchEmployee').value.trim()) { 
                filterEmployeeHistory(); 
            } 
            closeDialog('editTransactionDialog'); 
            editingTransactionId = null; 
 
            const sign = newAmount >= 0 ? '+' : ''; 
            alert(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t ƒë∆°n h√†ng:\nS·ªë ti·ªÅn m·ªõi: ${sign}${formatCurrency(newAmount)}`); 
        } 
 
        function deleteSingleTransaction() { 
            if (!editingTransactionId) return; 
 
            const paidTransactionIndex = paidTransactions.findIndex(t => t.id === editingTransactionId); 
            const unpaidTransactionIndex = unpaidTransactions.findIndex(t => t.id === editingTransactionId); 
            let transactionIndex = -1; 
            let transactionArray = null; 
 
            if (paidTransactionIndex !== -1) { 
                transactionIndex = paidTransactionIndex; 
                transactionArray = paidTransactions; 
            } else if (unpaidTransactionIndex !== -1) { 
                transactionIndex = unpaidTransactionIndex; 
                transactionArray = unpaidTransactions; 
            } 
 
            if (transactionIndex === -1) { 
                alert('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng ƒë·ªÉ x√≥a.'); 
                return; 
            } 
 
            showConfirmDialog( 
                'X√≥a ƒë∆°n h√†ng n√†y?', 
                'B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n h√†ng n√†y kh√¥ng?', 
                () => { 
                    transactionArray.splice(transactionIndex, 1); 
                     
                    // L∆∞u v√†o localStorage 
                    if (transactionArray === paidTransactions) { 
                        localStorage.setItem('paidEmployeeTransactions', JSON.stringify(paidTransactions)); 
                    } else { 
                        localStorage.setItem('unpaidEmployeeTransactions', JSON.stringify(unpaidTransactions)); 
                    } 
 
                    updateStats(); 
                    updateOrderStatistics(); 
                    if (document.getElementById('searchEmployee').value.trim()) { 
                        filterEmployeeHistory(); 
                    } 
                    closeDialog('confirmDialog'); 
                    closeDialog('editTransactionDialog'); 
                    editingTransactionId = null; 
                    alert('‚úÖ ƒê√£ x√≥a ƒë∆°n h√†ng th√†nh c√¥ng!'); 
                } 
            ); 
        } 
 
        function deleteEmployee() { 
            const employeeName = document.getElementById('employeeToDelete').value.trim(); 
 
            if (!employeeName) { 
                alert('‚ùå Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n c·∫ßn x√≥a!'); 
                return; 
            } 
 
            const allPaidTransactionsForEmployee = paidTransactions.filter(t => t.employeeName.toLowerCase() === employeeName.toLowerCase()); 
            const allUnpaidTransactionsForEmployee = unpaidTransactions.filter(t => t.employeeName.toLowerCase() === employeeName.toLowerCase()); 
 
            if (allPaidTransactionsForEmployee.length === 0 && allUnpaidTransactionsForEmployee.length === 0) { 
                alert('‚ùå Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o cho nh√¢n vi√™n n√†y!'); 
                return; 
            } 
 
            showConfirmDialog( 
                `X√≥a to√†n b·ªô ƒë∆°n c·ªßa "${employeeName}"?`, 
                `B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${allPaidTransactionsForEmployee.length + allUnpaidTransactionsForEmployee.length} ƒë∆°n h√†ng c·ªßa nh√¢n vi√™n n√†y?`, 
                () => { 
                    // X√≥a t·∫•t c·∫£ ƒë∆°n h√†ng ƒë√£ thanh to√°n c·ªßa nh√¢n vi√™n 
                    paidTransactions = paidTransactions.filter(t => t.employeeName.toLowerCase() !== employeeName.toLowerCase()); 
                    // X√≥a t·∫•t c·∫£ ƒë∆°n h√†ng n·ª£ c·ªßa nh√¢n vi√™n 
                    unpaidTransactions = unpaidTransactions.filter(t => t.employeeName.toLowerCase() !== employeeName.toLowerCase()); 
 
                    // L∆∞u v√†o localStorage 
                    localStorage.setItem('paidEmployeeTransactions', JSON.stringify(paidTransactions)); 
                    localStorage.setItem('unpaidEmployeeTransactions', JSON.stringify(unpaidTransactions)); 
 
                    document.getElementById('employeeToDelete').value = ''; 
                    updateStats(); 
                    updateOrderStatistics(); 
                    document.getElementById('searchEmployee').value = ''; 
                    document.getElementById('employeeStats').style.display = 'none'; 
                    document.getElementById('transactionSection').style.display = 'none'; 
                    closeDialog('confirmDialog'); 
                    alert('‚úÖ ƒê√£ x√≥a to√†n b·ªô ƒë∆°n h√†ng c·ªßa nh√¢n vi√™n n√†y!'); 
                } 
            ); 
        } 
 
        function resetAllData() { 
            showConfirmDialog( 
                'X√≥a to√†n b·ªô d·ªØ li·ªáu?', 
                'T·∫•t c·∫£ ƒë∆°n h√†ng s·∫Ω b·ªã x√≥a Vƒ®NH VI·ªÑN!', 
                () => { 
                    localStorage.removeItem('paidEmployeeTransactions'); 
                    localStorage.removeItem('unpaidEmployeeTransactions'); 
                    localStorage.removeItem('pendingEmployeeTransactions'); 
                    localStorage.removeItem('orderStatistics'); 
                    paidTransactions = []; 
                    unpaidTransactions = []; 
                    pendingTransactions = []; 
                    orderStatistics = {}; 
                    currentEmployeeOrders = []; 
                    updateStats(); 
                    updateOrderStatisticsUI(); 
                    document.getElementById('searchEmployee').value = ''; 
                    document.getElementById('employeeStats').style.display = 'none'; 
                    document.getElementById('transactionSection').style.display = 'none'; 
                    closeDialog('confirmDialog'); 
                    alert('‚úÖ ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu!'); 
                } 
            ); 
        } 
 
        function filterEmployeeHistory() { 
            const searchTerm = document.getElementById('searchEmployee').value.trim().toLowerCase(); 
            const employeeStats = document.getElementById('employeeStats'); 
            const transactionSection = document.getElementById('transactionSection'); 
 
            if (!searchTerm) { 
                employeeStats.style.display = 'none'; 
                transactionSection.style.display = 'none'; 
                return; 
            } 
 
            const allTransactionsForEmployee = [ 
                ...paidTransactions.filter(t => t.employeeName.toLowerCase().includes(searchTerm)), 
                ...unpaidTransactions.filter(t => t.employeeName.toLowerCase().includes(searchTerm)) 
            ]; 
 
            if (allTransactionsForEmployee.length === 0) { 
                employeeStats.style.display = 'none'; 
                transactionSection.style.display = 'block'; 
                document.getElementById('transactionList').innerHTML = '<div class="no-data">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o cho nh√¢n vi√™n n√†y.</div>'; 
                return; 
            } 
 
            const totalPaidAmount = paidTransactions 
                .filter(t => t.employeeName.toLowerCase().includes(searchTerm)) 
                .reduce((sum, t) => sum + t.orderAmount, 0); 
            const totalUnpaidAmount = unpaidTransactions 
                .filter(t => t.employeeName.toLowerCase().includes(searchTerm)) 
                .reduce((sum, t) => sum + t.orderAmount, 0); 
            const todayPaidAmount = paidTransactions 
                .filter(t => t.employeeName.toLowerCase().includes(searchTerm) && t.date === getTodayDate()) 
                .reduce((sum, t) => sum + t.orderAmount, 0); 
            const todayUnpaidAmount = unpaidTransactions 
                .filter(t => t.employeeName.toLowerCase().includes(searchTerm) && t.date === getTodayDate()) 
                .reduce((sum, t) => sum + t.orderAmount, 0); 
 
            employeeStats.innerHTML = ` 
                <div style="display: flex; justify-content: space-between; align-items: flex-start;"> 
                    <div> 
                        <h4 style="margin: 0; color: #333;">üìä Th·ªëng k√™ cho ${searchTerm.toUpperCase()}</h4> 
                        <p style="margin: 5px 0; color: #666;"> 
                            ƒê√£ thanh to√°n: +${formatCurrency(totalPaidAmount)} |    
                            ƒêang n·ª£: +${formatCurrency(totalUnpaidAmount)} |    
                            H√¥m nay: +${formatCurrency(todayPaidAmount + todayUnpaidAmount)} |    
                            <span style="color: #e74c3c;">${allTransactionsForEmployee.length} ƒë∆°n</span> 
                        </p> 
                    </div> 
                    <div style="font-size: 1.2em; font-weight: bold; color: #27ae60;"> 
                        +${formatCurrency(totalPaidAmount + totalUnpaidAmount)} 
                    </div> 
                </div> 
            `; 
            employeeStats.style.display = 'block'; 
            transactionSection.style.display = 'block'; 
            displayTransactions(allTransactionsForEmployee); 
        } 
 
        function showConfirmDialog(title, message, onConfirmCallback) { 
            document.getElementById('confirmTitle').textContent = title; 
            document.getElementById('confirmMessage').textContent = message; 
            document.getElementById('confirmActionBtn').onclick = onConfirmCallback; 
            showDialog('confirmDialog'); 
        } 
 
        function showDialog(dialogId) { 
            document.getElementById('overlay').style.display = 'block'; 
            document.getElementById(dialogId).style.display = 'block'; 
        } 
 
        function closeDialog(dialogId) { 
            document.getElementById('overlay').style.display = 'none'; 
            document.getElementById(dialogId).style.display = 'none'; 
        } 
 
        document.addEventListener('keypress', function(e) { 
            if (e.key === 'Enter' && e.target.id === 'orderAmount') { 
                saveOrder(); 
            } else if (e.key === 'Enter' && e.target.id === 'employeeName') { 
                e.preventDefault(); 
                document.getElementById('customerName').focus(); 
            } else if (e.key === 'Enter' && e.target.id === 'customerName') { 
                e.preventDefault(); 
                document.getElementById('customerAddress').focus(); 
            } else if (e.key === 'Enter' && e.target.id === 'customerAddress') { 
                e.preventDefault(); 
                document.getElementById('customerPhone').focus(); 
            } else if (e.key === 'Enter' && e.target.id === 'customerPhone') { 
                e.preventDefault(); 
                document.getElementById('orderAmount').focus(); 
            } else if (e.key === 'Enter' && e.target.id === 'newOrderAmount') { 
                addNewOrder(); 
            } else if (e.key === 'Enter' && e.target.id === 'adjustmentAmount') { 
                adjustTransactionAmount('add'); 
            } 
        }); 
    </script> 
</body> 
</html>
